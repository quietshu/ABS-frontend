var books=[{isbn:"9787532739974",title:"一九八四",author:"乔治·奥威尔 ",retail_price:"13.00",publisher:"上海译文出版社",stock:2e3},{isbn:"9787563358243",title:"哥伦比亚的倒影",author:"木心",retail_price:"22.00",publisher:"广西师范大学出版社",stock:500},{isbn:"9780520071469",title:"The New Typography",author:"Jan/ McLean Tschichold",retail_price:"450.00",publisher:"University of California Press",stock:200},{isbn:"9780140621006",title:"The Adventures of Sherlock Holmes",author:"Sir Arthur Conan Doyle",retail_price:"15.00",publisher:"Penguin Books",stock:600},{isbn:"9787111375296",title:"数据库系统概念",author:"Abraham Silberschatz / Henry F.Korth / S.Sudarshan",retail_price:"99.00",publisher:"机械工业出版社",stock:1e3}],orders=[{isbn:"9787532739974",order_id:"001",order_time:"1420030759037",order_price:"10.00",order_amount:"500",payment_status:1},{isbn:"9787532739974",order_id:"002",order_time:"1420090759037",order_price:"10.00",order_amount:"500",payment_status:1},{isbn:"9780140621006",order_id:"003",order_time:"1429040759037",order_price:"13.00",order_amount:"100",payment_status:2},{isbn:"9787111375296",order_id:"004",order_time:"1429540759037",order_price:"80.00",order_amount:"1000",payment_status:0}],bills=[{type:"outgoings",time:"1420030759037",order_id:"001",out_total:5e3},{type:"incomes",time:"1420030759047",isbn:"9787563358243",amount:"3",in_total:66},{type:"incomes",time:"1420050759037",isbn:"9787563358243",amount:"2",in_total:44},{type:"incomes",time:"1419700759037",isbn:"9787111375296",amount:"2",in_total:198},{type:"outgoings",time:"1420090759037",order_id:"002",out_total:5e3},{type:"outgoings",time:"1429040759037",order_id:"003",out_total:1300},{type:"outgoings",time:"1429540759037",order_id:"004",out_total:8e3}],users=[{user_id:0,user_name:"root",realname:"John Root",work_id:"000",gender:0,age:20},{user_id:1,user_name:"testuser1",realname:"小明",work_id:"001",gender:1,age:30}],cookie="test";window.api={user:{i:function(o){return cookie?void(o&&o([{user_id:0,user_name:"root",realname:"John Root",work_id:"000",gender:0,age:20}])):void(window.location.hash="#/login")},logout:function(o){window.location.hash="#/login",cookie="",o&&o("OK")},login:function(o,i,n){cookie="test",window.location.hash="#/",n&&n("OK")},"new":function(o,i){return cookie?void(i&&i("OK")):void(window.location.hash="#/login")},"delete":function(o,i){return cookie?void(i&&i("OK")):void(window.location.hash="#/login")},all:function(o){return cookie?void(o&&o(users)):void(window.location.hash="#/login")}},book:{all:function(o){return cookie?void(o&&o(books)):void(window.location.hash="#/login")},search:function(o,i){if(!cookie)return void(window.location.hash="#/login");var n=[];books.forEach(function(i){-1!==JSON.stringify(i).indexOf(o)&&n.push(i)}),i&&i(n)},data:function(o,i){if(!cookie)return void(window.location.hash="#/login");var n=[];books.forEach(function(i){i.isbn==o&&n.push(i)}),i&&i(n)},"new":function(o,i){return cookie?void(i&&i("OK")):void(window.location.hash="#/login")},"delete":function(o,i){return cookie?void(i&&i("OK")):void(window.location.hash="#/login")},update:function(o,i,n){return cookie?void(n&&n("OK")):void(window.location.hash="#/login")},sell:function(o,i,n){return cookie?void(n&&n("OK")):void(window.location.hash="#/login")}},order:{all:function(o){return cookie?void(o&&o(orders)):void(window.location.hash="#/login")},data:function(o,i){if(!cookie)return void(window.location.hash="#/login");var n=[];orders.forEach(function(i){i.order_id==o&&n.push(i)}),i&&i(n)},"new":function(o,i){return cookie?void(i&&i("OK")):void(window.location.hash="#/login")},pay:function(o,i){return cookie?void(i&&i("OK")):void(window.location.hash="#/login")},puton:function(o,i){return cookie?void(i&&i("OK")):void(window.location.hash="#/login")},"delete":function(o,i){return cookie?void(i&&i("OK")):void(window.location.hash="#/login")}},bill:function(o,i,n){return cookie?void(n&&n(bills)):void console.log(window.location.hash="#/login")}};
angular.module("ABS",["ui.bootstrap","ui.router","ngCookies","pascalprecht.translate","chart.js"]).config(["$translateProvider",function(e){e.translations("en",{"《":" «","》":"»"}),e.translations("zh",{":":"：",",":"，",OK:"确认",Cancel:"取消",Back:"返回",Update:"更新",Status:"状态",Logout:"登出",Display:"显示",Date:"日期",Books:"图书",Incomes:"收入",Outgoings:"支出",Orders:"订单",Order:"订单",Bills:"账单",Admin:"管理",Search:"查询",Title:"书名",Authors:"作者",Price:"价格","Selling Price":"售价",Amount:"总量",Total:"总价",Details:"详情",Stock:"库存",Add:"添加","Put On Shelf":"上架",Password:"密码","Real Name":"真名","Work ID":"工号",Age:"年龄",Gender:"性别","User Name":"用户名","Sale Amount":"售出量","On Shelf":"已上架","Off Shelf":"未上架","Order ID":"订单号","Order Price":"订购价",Publisher:"出版商","No result found":"无结果","Waiting for Payment":"待支付","Current user":"当前用户",Profile:"个人信息","User info":"个人信息","Edit Book":"编辑图书",Payment:"付款状态","Finish Payment":"完成付款","Cancel Order":"取消订单","Current Stock":"当前库存","Order Amount":"订购数量","Related Orders":"相关订单","Related Sales":"相关销售","Edit Details":"编辑信息","Back to List":"返回列表","Add New Books":"添加新书","Add New Order":"创建订单","Sort by amount":"按金额排序","Add New Users":"添加新用户","Payment Already Processed":"已处理付款","You can search ISBN, title, author or publisher.":"支持搜索 ISBN、标题、作者以及出版物等","Please finish your payment as soon as possible.":"请您尽快完成订单的支付","Notice! Books in this order are not added to stock yet.":"注意！此次进货的书目还未上架","Congratulations! Order has been completed.":"恭喜您，此订单已完成","Payment Already Processed & Off Shelf":"已完成付款，还未上架",Today:"今天",Yesterday:"昨天","Last 7 Days":"7 天内","Last 30 Days":"30 天内","This Month":"本月","Last Month":"上个月",From:"自",To:"至",Custom:"自定区间",Su:"日",Mo:"一",Tu:"二",We:"三",Th:"四",Fr:"五",Sa:"六",January:"一月",February:"二月",March:"三月",April:"四月",May:"五月",June:"六月",July:"七月",August:"八月",September:"九月",October:"十月",November:"十一月",December:"十二月"}),e.preferredLanguage("zh")}]);
"use strict";angular.module("ABS").config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("index",{url:"/",templateUrl:"templates/books.html"}).state("login",{url:"/login",templateUrl:"templates/login.html"}).state("me",{url:"/me",templateUrl:"templates/me.html"}).state("user",{url:"/users",templateUrl:"templates/admin.html"}).state("userNew",{url:"/users/new",templateUrl:"templates/admin-new.html"}).state("books",{url:"/books",templateUrl:"templates/books.html"}).state("book",{url:"/books/{bookId:int}",templateUrl:"templates/book.html",controller:["$scope","$stateParams",function(t,e){t.state={isbn:e.bookId}}]}).state("bookEdit",{url:"/books/{bookId:int}/edit",templateUrl:"templates/book-edit.html",controller:["$scope","$stateParams",function(t,e){t.state={isbn:e.bookId}}]}).state("bookNew",{url:"/books/new",templateUrl:"templates/book-new.html"}).state("orders",{url:"/orders",templateUrl:"templates/orders.html"}).state("order",{url:"/orders/{orderId:int}",templateUrl:"templates/order.html",controller:["$scope","$stateParams",function(t,e){t.state={order_id:e.orderId}}]}).state("orderNew",{url:"/orders/new",templateUrl:"templates/order-new.html"}).state("bills",{url:"/bills",templateUrl:"templates/bills.html"})}]);
function AlertsCtrl(e){e.alerts=[{type:"success",msg:"Thanks for visiting! Feel free to create pull requests to improve the dashboard!"},{type:"danger",msg:"Found a bug? Create an issue with as many details as you can."}],e.addAlert=function(){e.alerts.push({msg:"Another alert!"})},e.closeAlert=function(t){e.alerts.splice(t,1)}}angular.module("ABS").controller("AlertsCtrl",["$scope",AlertsCtrl]);
function BillCtrl(t,a,n){t.bill=[],t.chartOutgoing={},t.chartOutgoing.labels=[],t.chartOutgoing.series=["Outgoing"],t.chartOutgoing.data=[[]],t.chartIncome={},t.chartIncome.labels=[],t.chartIncome.series=["Income"],t.chartIncome.data=[[]],t.chartTotal={},t.chartTotal.labels=[],t.chartTotal.series=["Income","Outgoing"],t.chartTotal.data=[[],[]],t.query=function(n,o){api.bill(n,o,function(e){t.bill=e,t.chartOutgoing.labels=[],t.chartOutgoing.data=[[]],t.bill.forEach(function(a){"outgoings"==a.type?(t.chartOutgoing.labels.push(new Date(+a.time).toJSON().split("T")[0]),t.chartOutgoing.data[0].push(a.out_total),t.chartTotal.labels.push(new Date(+a.time).toJSON().split("T")[0]),t.chartTotal.data[1].push(a.out_total),t.chartTotal.data[0].push(null)):"incomes"==a.type&&(t.chartIncome.labels.push(new Date(+a.time).toJSON().split("T")[0]),t.chartIncome.data[0].push(a.in_total),t.chartTotal.labels.push(new Date(+a.time).toJSON().split("T")[0]),t.chartTotal.data[0].push(a.in_total),t.chartTotal.data[1].push(null))}),a.search("from",n),a.search("to",o),window.location.hash="#"+a.$$url})};var o=a.search();t.view={splitView:!o.v},t.viewChange=function(){a.search("v",t.view.splitView?null:!0)},t.sort={incomeSortMethod:!1,outgoingSortMethod:!1,incomeSortBy:"-time",outgoingSortBy:"-time"},t.changeSortMethod=function(){t.sort.incomeSortBy=t.sort.incomeSortMethod?"-in_total":"-time",t.sort.outgoingSortBy=t.sort.outgoingSortMethod?"-out_total":"-time"},function(){var a=jQuery("#reportrange");o.from&&o.to?(a.find("span").html(o.from.replace(/-/g,"/")+" - "+o.to.replace(/-/g,"/")),t.query(o.from,o.to)):(a.find("span").html(moment().subtract(29,"days").format("YYYY/MM/D")+" - "+moment().format("YYYY/MM/D")),t.query(moment().subtract(29,"days").format("YYYY-MM-D"),moment().format("YYYY-MM-D")));for(var e=[n.instant("Today"),[moment(),moment()],n.instant("Yesterday"),[moment().subtract(1,"days"),moment().subtract(1,"days")],n.instant("Last 7 Days"),[moment().subtract(6,"days"),moment()],n.instant("Last 30 Days"),[moment().subtract(29,"days"),moment()],n.instant("This Month"),[moment().startOf("month"),moment().endOf("month")],n.instant("Last Month"),[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]],s={},r=0;r<e.length;r+=2)s[e[r]]=e[r+1];a.daterangepicker({format:"YYYY/MM/D",startDate:moment().subtract(29,"days"),endDate:moment(),minDate:"2011/10/5",maxDate:"2015/12/31",dateLimit:{days:60},showDropdowns:!1,showWeekNumbers:!0,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:s,opens:"right",drops:"down",buttonClasses:["btn","btn-sm"],applyClass:"btn-primary",cancelClass:"btn-default",separator:" to ",locale:{applyLabel:n.instant("OK"),cancelLabel:n.instant("Cancel"),fromLabel:n.instant("From"),toLabel:n.instant("To"),customRangeLabel:n.instant("Custom"),daysOfWeek:[n.instant("Su"),n.instant("Mo"),n.instant("Tu"),n.instant("We"),n.instant("Th"),n.instant("Fr"),n.instant("Sa")],monthNames:[n.instant("January"),n.instant("February"),n.instant("March"),n.instant("April"),n.instant("May"),n.instant("June"),n.instant("July"),n.instant("August"),n.instant("September"),n.instant("October"),n.instant("November"),n.instant("December")],firstDay:1}},function(n,o){t.query(n.format("YYYY-MM-D"),o.format("YYYY-MM-D")),a.find("span").html(n.format("YYYY/MM/D")+" - "+o.format("YYYY/MM/D"))})}()}angular.module("ABS").controller("BillCtrl",["$scope","$location","$translate",BillCtrl]);
function BookDetailCtrl(o){api.book.data(o.state.isbn,function(t){t.length&&(o.book=t[0])}),o.goBack=function(){window.history.back()}}angular.module("ABS").controller("BookDetailCtrl",["$scope",BookDetailCtrl]);
function BookEditCtrl(r,o){r.book={isbn:"",title:"",author:"",retail_price:"",publisher:"",stock:0},r.error={isbn:"",title:"",author:"",retail_price:"",publisher:""},api.book.data(r.state.isbn,function(o){o.length&&(r.book=o[0])}),r.goBack=function(){window.history.back()},r.update=function(){var o=0;r.book.isbn=+r.book.isbn||"",!Number.isSafeInteger(r.book.isbn)||r.book.isbn<1?(r.error.isbn="has-error",o=1):r.error.isbn="",r.book.title.length?r.error.title="":(r.error.title="has-error",o=1),r.book.author.length?r.error.author="":(r.error.author="has-error",o=1),r.book.publisher.length?r.error.publisher="":(r.error.publisher="has-error",o=1),r.book.retail_price=+r.book.retail_price||"",r.book.retail_price<=0?(r.error.retail_price="has-error",o=1):r.error.retail_price="",o||api.book.update(r.state.isbn,r.book,function(r){})}}angular.module("ABS").controller("BookEditCtrl",["$scope","$location",BookEditCtrl]);
function BookNewCtrl(r,o){r.book={isbn:"",title:"",author:"",retail_price:"",publisher:"",stock:0},r.error={isbn:"",title:"",author:"",retail_price:"",publisher:""},r.goBack=function(){window.history.back()},r.add=function(){var o=0;r.book.isbn=+r.book.isbn||"",!Number.isSafeInteger(r.book.isbn)||r.book.isbn<1?(r.error.isbn="has-error",o=1):r.error.isbn="",r.book.title.length?r.error.title="":(r.error.title="has-error",o=1),r.book.author.length?r.error.author="":(r.error.author="has-error",o=1),r.book.publisher.length?r.error.publisher="":(r.error.publisher="has-error",o=1),r.book.retail_price=+r.book.retail_price||"",r.book.retail_price<=0?(r.error.retail_price="has-error",o=1):r.error.retail_price="",o||api.book["new"](r.book,function(r){})}}angular.module("ABS").controller("BookNewCtrl",["$scope","$location",BookNewCtrl]);
function BookSearchCtrl(o,e){o.books={keywords:"",result:[]},api.book.all(function(e){o.books.result=e}),o.keywordsChange=function(){o.books.keywords.length?(e.search("q",o.books.keywords),api.book.search(o.books.keywords,function(e){o.books.result=e})):(e.search("q",null),api.book.all(function(e){o.books.result=e}))},e.search().q&&(o.books.keywords=e.search().q,o.keywordsChange()),o.$watch(function(){return e.search().q},function(){o.books.keywords=e.search().q||"",o.keywordsChange()})}angular.module("ABS").controller("BookSearchCtrl",["$scope","$location",BookSearchCtrl]);
function MasterCtrl(t,e,n,o,i){o.me={},o.login={},api.user.i(function(t){t.length?o.me=t[0]:n.path("#/login")}),o.signin=function(){api.user.login(o.login.username,o.login.password,function(t){})},o.logout=function(){api.user.logout(function(t){})},o.changeLang=function(t){i.use(t)},t.sidebarLists=[["#/books","Books","book"],["#/orders","Orders","credit-card"],["#/bills","Bills","table"],["#/users","Admin","users"]],t.getClass=function(t){return n.path().substr(0,t.length-1)==t.slice(1)?"active":""},t.getCurrentView=function(){return n.path().split("/")[1].toUpperCase()||"HOME"};var r=992;t.getWidth=function(){return window.innerWidth},t.$watch(t.getWidth,function(n,o){t.toggle=n>=r?angular.isDefined(e.get("toggle"))?e.get("toggle")?!0:!1:!0:!1}),t.toggleSidebar=function(){t.toggle=!t.toggle,e.put("toggle",t.toggle)},window.onresize=function(){t.$apply()}}angular.module("ABS").controller("MasterCtrl",["$scope","$cookieStore","$location","$rootScope","$translate",MasterCtrl]);
function OrderDetailCtrl(r){api.order.data(r.state.order_id,function(o){o.length&&(r.order=o[0],api.book.data(r.order.isbn,function(o){r.book=o.length?o[0]:{}}))}),r.goBack=function(){window.history.back()},r.pay=function(){api.order.pay(r.order.order_id,function(o){"OK"==o&&(r.order.payment_status=1)})},r.onShelf=function(){api.order.puton(r.order.order_id,function(o){"OK"==o&&(r.order.payment_status=2)})},r.cancel=function(){api.order["delete"](r.order.order_id,function(o){"OK"==o&&r.goBack()})}}angular.module("ABS").controller("OrderDetailCtrl",["$scope",OrderDetailCtrl]);
function OrderNewCtrl(r,o){r.book={isbn:"",title:"",author:"",retail_price:"",publisher:""},r.order={order_price:"",order_amount:""},r.error={isbn:"",title:"",author:"",retail_price:"",publisher:"",order_price:"",order_amount:""},r.lock=!1,r.goBack=function(){window.history.back()},r.isbnChange=function(){if(r.book.isbn=+r.book.isbn||"",r.book.isbn)api.book.data(r.book.isbn,function(o){if(console.log(o),o.length){r.lock=!0;for(var e in o[0])o[0].hasOwnProperty(e)&&(r.book[e]=o[0][e])}else if(r.lock){r.lock=!1;for(var e in r.book)r.book.hasOwnProperty(e)&&"isbn"!=e&&(r.book[e]="")}});else if(r.lock){r.lock=!1;for(var o in r.book)r.book.hasOwnProperty(o)&&"isbn"!=o&&(r.book[o]="")}},r.add=function(){var o=0;if(r.book.isbn=+r.book.isbn||"",!Number.isSafeInteger(r.book.isbn)||r.book.isbn<1?(r.error.isbn="has-error",o=1):r.error.isbn="",r.book.title.length?r.error.title="":(r.error.title="has-error",o=1),r.book.author.length?r.error.author="":(r.error.author="has-error",o=1),r.book.publisher.length?r.error.publisher="":(r.error.publisher="has-error",o=1),r.book.retail_price=+r.book.retail_price||"",r.book.retail_price<=0||!r.book.retail_price?(r.error.retail_price="has-error",o=1):r.error.retail_price="",console.log(r.order),r.order.order_price=+r.order.order_price||"",r.error.order_price=r.order.order_price<0||!r.order.order_price?"has-error":"",r.order.order_amount=+r.order.order_amount||"",r.error.order_amount=r.order.order_amount<0||!r.order.order_amount?"has-error":"",!o){var e={isbn:r.book.isbn,order_time:(new Date).getTime(),order_price:r.order.order_price,order_amount:r.order.order_amount,order_status:0};if(r.lock)api.order["new"](e,function(o){"OK"==o&&r.goBack()});else{var i={isbn:r.book.isbn,title:r.book.title,author:r.book.author,publisher:r.book.publisher,retail_price:r.book.retail_price,stock:0};api.book["new"](i,function(o){"OK"==o&&api.order["new"](e,function(o){"OK"==o&&r.goBack()})})}}}}angular.module("ABS").controller("OrderNewCtrl",["$scope","$location",OrderNewCtrl]);
function OrderSearchCtrl(r,e,o){r.orders={show:[],all:[],filter:[!0,!0,!0],keywords:"",isbn:e.search().isbn||""},api.order.all(function(e){r.orders.all=e,r.orders.show=e}),r.filterChange=function(){var e=[r.orders.filter[0]?0:-1,r.orders.filter[1]?1:-1,r.orders.filter[2]?2:-1];r.orders.show=[],r.orders.all.forEach(function(o){-1!=e.indexOf(o.payment_status)&&r.orders.show.push(o)})},r.$watch(function(){return e.search().isbn},function(){r.orders.isbn=e.search().isbn||""})}angular.module("ABS").controller("OrderSearchCtrl",["$scope","$location","$filter",OrderSearchCtrl]);
angular.module("ABS").filter("sum",function(){return function(n,r){for(var u=0,t=0;t<n.length;++t)u+=+(n[t][r]||0);return u}});
function UserCtrl(r){r.users=[],api.user.all(function(e){r.user=e})}angular.module("ABS").controller("UserCtrl",["$scope",UserCtrl]);
function UserNewCtrl(r,e){r.user={password:"",user_name:"",realname:"",work_id:"",gender:"",age:""},r.error={password:"",user_name:"",realname:"",work_id:"",gender:"",age:""},r.goBack=function(){window.history.back()},r.add=function(){var e=0;r.user.user_name.length?r.error.user_name="":(r.error.user_name="has-error",e=1),r.user.password.length<8?(r.error.password="has-error",e=1):r.error.password="",r.user.realname.length?r.error.realname="":(r.error.realname="has-error",e=1),r.user.work_id=+r.user.work_id||"",r.user.work_id<=0?(r.error.work_id="has-error",e=1):r.error.work_id="",r.user.age=+r.user.age||"",r.user.age<=0?(r.error.age="has-error",e=1):r.error.age="",r.user.gender.length?r.error.gender="":(r.error.gender="has-error",e=1),e||api.user["new"](r.user,function(r){})}}angular.module("ABS").controller("UserNewCtrl",["$scope","$location",UserNewCtrl]);
function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("ABS").directive("rdLoading",rdLoading);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"@?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("ABS").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("ABS").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("ABS").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("ABS").directive("rdWidget",rdWidget);